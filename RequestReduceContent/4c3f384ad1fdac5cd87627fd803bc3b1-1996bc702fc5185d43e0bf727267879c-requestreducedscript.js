(function(n){var i,t,e=function(t,i){return{width:t-n(window).width()-n(window).scrollLeft(),height:i-n(window).height()-n(window).scrollTop()}},r=function(r){var u,f,e;t[i.activeId].currentHover?(u=r?t[i.activeId].currentHover.nextAll(":not(."+t[i.activeId].separatorClass+"):visible:first"):t[i.activeId].currentHover.prevAll(":not(."+t[i.activeId].separatorClass+"):visible:first"),u.length==0&&(u=t[i.activeId].currentHover.parent().find("> li:visible"),u=r?n(u[0]):n(u[u.length-1])),u.mouseover()):(f=n("#"+i.activeId+", #"+i.activeId+" ul").filter(function(){return n(this).is(":visible")&&n(this).parents(":hidden").length==0}),f.length>0&&(e=n(f[f.length-1]).find("> li:visible"),n(e[r?0:e.length-1]).mouseover()))},o=function(){for(cm in t)n(t[cm].allContext).removeClass(i.activeClass)},f=function(){i.activeId&&n("#"+i.activeId).add("#"+i.activeId+" ul").hide(),clearInterval(i.keyUpDown),i.keyUpDownStop=!1,t[i.activeId]&&(t[i.activeId].currentHover=null),i.activeId=null,n(document).unbind(".jeegoocontext"),n(window).unbind("resize.jeegoocontext")},u=function(r){if(i.activeId&&t[i.activeId].onHide)if(t[i.activeId].onHide.apply(n("#"+i.activeId),[r,t[i.activeId].context])==!1)return!1;o(),f()};n.fn.jeegoocontext=function(s,h){var a,c,l;return i||(i={}),t||(t={}),h&&h.menuClass&&(i.menuClass=h.menuClass),i.menuClass||(i.menuClass="jeegoocontext"),h&&h.activeClass&&(i.activeClass=h.activeClass),i.activeClass||(i.activeClass="active"),t[s]=n.extend({hoverClass:"hover",submenuClass:"submenu",separatorClass:"separator",operaEvent:"ctrl+click",fadeIn:200,delay:300,keyDelay:100,widthOverflowOffset:0,heightOverflowOffset:0,submenuLeftOffset:0,submenuTopOffset:0,autoAddSubmenuArrows:!0,startLeftOffset:0,startTopOffset:0,keyboard:!0},h||{}),t[s].allContext=this.selector,n("#"+s).find("li")[t[s].livequery?"expire":"unbind"](".jeegoocontext")[t[s].livequery?"livequery":"bind"]("mouseover.jeegoocontext",function(i){var r=t[s].currentHover=n(this),c,h,u;clearTimeout(t[s].show),clearTimeout(t[s].hide),n("#"+s).find("*").removeClass(t[s].hoverClass),c=r.parents("li"),r.add(r.find("> *")).add(c).add(c.find("> *")).addClass(t[s].hoverClass),h=!0,t[s].onHover&&t[s].onHover.apply(this,[i,t[s].context])==!1&&(h=!1);if(!t[s].proceed)return t[s].show=setTimeout(function(){t[s].proceed=!0,r.mouseover()},t[s].delay),!1;t[s].proceed=!1,r.parent().find("ul").not(r.find("> ul")).hide();if(!h)return i.preventDefault(),!1;u=r.find("> ul");if(u.length!=0){var f=r.offset(),o=e(f.left+r.parent().width()+t[s].submenuLeftOffset+u.width()+t[s].widthOverflowOffset,f.top+t[s].submenuTopOffset+u.height()+t[s].heightOverflowOffset),a=u.parent().parent().width(),l=f.top-r.parent().offset().top;u.css({left:o.width>0&&!t[s].ignoreWidthOverflow?-a-t[s].submenuLeftOffset+"px":a+t[s].submenuLeftOffset+"px",top:o.height>0&&!t[s].ignoreHeightOverflow?l-o.height+t[s].submenuTopOffset+"px":l+t[s].submenuTopOffset+"px"}),u.fadeIn(t[s].fadeIn)}i.stopPropagation()})[t[s].livequery?"livequery":"bind"]("click.jeegoocontext",function(r){if(t[s].onSelect)if(t[s].onSelect.apply(this,[r,t[s].context])==!1)return!1;f(),n(t[s].context).removeClass(i.activeClass),r.stopPropagation()}),a=document.createElement("div"),a.setAttribute("oncontextmenu",""),c=t[s].event,c?c+=".jeegoocontext":c=typeof a.oncontextmenu!="undefined"?"contextmenu.jeegoocontext":t[s].operaEvent+".jeegoocontext",c.indexOf("+")!=-1&&(l=c.split("+",2),t[s].modifier=l[0]+"Key",c=l[1]),this[t[s].livequery?"livequery":"bind"](c,function(h){var c,a,l,y,v;if(typeof t[s].modifier=="string"&&!h[t[s].modifier])return;t[s].context=this,c=n("#"+s),t[s].openBelowContext?(y=n(this).offset(),a=y.left,l=y.top+n(this).outerHeight()):(a=h.pageX,l=h.pageY),a+=t[s].startLeftOffset,l+=t[s].startTopOffset,v=e(a+c.width()+t[s].widthOverflowOffset,l+c.height()+t[s].heightOverflowOffset),!t[s].ignoreWidthOverflow&&v.width>0&&(a-=v.width),t[s].openBelowContext||t[s].ignoreHeightOverflow||v.height<=0||(l-=v.height);if(t[s].onShow)if(t[s].onShow.apply(c,[h,t[s].context,a,l])==!1)return!1;return f(),i.activeId=s,n("#"+i.activeId).add("#"+i.activeId+" ul").hide(),o(),n(t[s].context).addClass(i.activeClass),c.find("li, li > *").removeClass(t[s].hoverClass),t[s].autoAddSubmenuArrows&&(c.find("li:has(ul)").not(":has(span."+t[s].submenuClass+")").prepend('<span class="'+t[s].submenuClass+'"></span>'),c.find("li").not(":has(ul)").find("> span."+t[s].submenuClass).remove()),c.css({left:a+"px",top:l+"px"}).fadeIn(t[s].fadeIn),t[s].openBelowContext&&n(window).bind("resize.jeegoocontext",function(){n("#"+s).css("left",n(t[s].context).offset().left+t[s].startLeftOffset+"px")}),n(document).bind("mouseover.jeegoocontext",function(r){if(n(r.relatedTarget).parents("#"+s).length>0){clearTimeout(t[s].show);var f=n(r.relatedTarget).parent().find("li");f.add(f.find("> *")).removeClass(t[s].hoverClass),t[i.activeId].currentHover=null,t[s].hide=setTimeout(function(){f.find("ul").hide(),t[s].autoHide&&u(r)},t[s].delay)}}).bind("click.jeegoocontext",u),t[s].keyboard&&n(document).bind("keydown.jeegoocontext",function(f){var o,e;switch(f.which){case 38:return i.keyUpDownStop?!1:(r(),i.keyUpDown=setInterval(r,t[i.activeId].keyDelay),i.keyUpDownStop=!0,!1);case 39:return t[i.activeId].currentHover?t[i.activeId].currentHover.find("ul:visible:first li:visible:first").mouseover():(o=n("#"+i.activeId+", #"+i.activeId+" ul:visible"),o.length>0&&n(o[o.length-1]).find(":visible:first").mouseover()),!1;case 40:return i.keyUpDownStop?!1:(r(!0),i.keyUpDown=setInterval(function(){r(!0)},t[i.activeId].keyDelay),i.keyUpDownStop=!0,!1);case 37:return t[i.activeId].currentHover?n(t[i.activeId].currentHover.parents("li")[0]).mouseover():(e=n("#"+i.activeId+" li."+t[i.activeId].hoverClass),e.length>0&&n(e[e.length-1]).mouseover()),!1;case 13:t[i.activeId].currentHover?t[i.activeId].currentHover.click():u(f);break;case 27:u(f)}}).bind("keyup.jeegoocontext",function(){clearInterval(i.keyUpDown),i.keyUpDownStop=!1}),!1})},n.fn.nojeegoocontext=function(){this.unbind(".jeegoocontext")}})(jQuery)