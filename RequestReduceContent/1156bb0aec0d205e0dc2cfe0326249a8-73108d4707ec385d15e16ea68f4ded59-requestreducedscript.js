function Files(n){hshow();var t={path:n};return $.ajax({url:SiteVars.ApplicationRelativeWebRoot+"admin/filemanager/AjaxFileManager.aspx/GetFiles",data:JSON.stringify(t),type:"POST",contentType:"application/json; charset=utf-8",beforeSend:onAjaxBeforeSend,dataType:"json",success:function(n){hhide();if(!n.d.Success){ShowStatus("warning",n.d.Message),$("#Container").html("");return}var t={d:n.d.Data};$("#Container").setTemplateURL(SiteVars.ApplicationRelativeWebRoot+"Templates/FileManager.htm?v=2",null,{filter_data:!1}),$("#Container").processTemplate(t),bindContext()}}),!1}function setMCE(n){tinyMCE.activeEditor.execCommand("mceInsertContent",!1,n)}function closefmD(){$("#fmD").slideUp(),fmdOpen=!1}function hhide(){$("#dwait").hide()}function hshow(){$("#dwait").show()}function appendFile(n){hshow();var t={path:n};return $.ajax({url:SiteVars.ApplicationRelativeWebRoot+"admin/filemanager/AjaxFileManager.aspx/AppendFile",data:JSON.stringify(t),type:"POST",contentType:"application/json; charset=utf-8",beforeSend:onAjaxBeforeSend,dataType:"json",success:function(n){hhide();if(!n.d.Success){ShowStatus("warning",n.d.Message);return}setMCE(n.d.Data)}}),!1}function deleteFile(n){if(!confirm('Are you sure you wish to delete the file "'+n+'"?\r\n\r\nThis operation cannot be undone.\r\n\r\nAny posts and pages that contain this file will contain broken links.'))return;hshow();var t={path:n};return $.ajax({url:SiteVars.ApplicationRelativeWebRoot+"admin/filemanager/AjaxFileManager.aspx/DeleteFile",data:JSON.stringify(t),type:"POST",contentType:"application/json; charset=utf-8",beforeSend:onAjaxBeforeSend,dataType:"json",success:function(n){hhide();if(!n.d.Success){ShowStatus("warning",n.d.Message);return}Files(n.d.Data),ShowStatus("success",n.d.Message)}}),!1}function setupRename(n){n.find("span:first").hide(),n.find("input[type=text]:first").data("handled-blur",!1).show().focus().keypress(function(n){n.which==13&&(n.preventDefault(),$(this).blur())}).blur(function(){var t,n,i;if($(this).data("handled-blur"))return;$(this).data("handled-blur",!0),bindContext(),$(this).parent("td").find("span:first").show(),$(this).hide(),t=$(this).attr("data-name"),n=$(this).val();if(t==n)return;if(confirm('Are you sure you wish to rename the file "'+t+'" to "'+n+'"?\r\n\r\nAny posts and pages that contain this file will contain broken links.'))i={path:$(this).attr("data-path"),newname:n},$.ajax({url:SiteVars.ApplicationRelativeWebRoot+"admin/filemanager/AjaxFileManager.aspx/RenameFile",data:JSON.stringify(i),type:"POST",contentType:"application/json; charset=utf-8",beforeSend:onAjaxBeforeSend,dataType:"json",success:function(n){hhide();if(!n.d.Success){ShowStatus("warning",n.d.Message);return}Files(n.d.Data),ShowStatus("success",n.d.Message)}});else{$(this).val($(this).attr("data-name"));return}})}function bindContext(){$("tr.fmDRow[data-type='1']").each(function(){$(this).jeegoocontext("menu",{widthOverflowOffset:0,heightOverflowOffset:3,submenuLeftOffset:0,submenuTopOffset:0,event:"click",openBelowContext:!0,onSelect:function(n,t){var i=$(t).attr("data-path");switch(parseInt($(this).attr("data-action"))){case 0:appendFile(i);break;case 3:deleteFile(i);break;case 2:$(t).nojeegoocontext(),setupRename($(t));break;case 1:cancelCrop(),$("#ImagePanel").find("h2:first").html("Image Tools: "+$(t).find("span:first").text()),$("#ImagePanel").find("img.fmDImgPrev:first").attr("src",SiteVars.ApplicationRelativeWebRoot+"image.axd?picture="+escape(i)+"&r="+Math.random()).attr("data-path",i),$(this).colorbox({inline:!0,height:"80%",width:"60%",href:"#ImagePanel"}).open()}},onShow:function(n,t){$(t).attr("data-path").FileExtension().IsImage()?$(this).find("li").show():$(this).find("li:eq(1)").hide()}})})}function imageChange(n){var t={path:$("#fmDImgPrev:first").attr("data-path"),change:n};$.ajax({url:SiteVars.ApplicationRelativeWebRoot+"admin/filemanager/AjaxFileManager.aspx/ChangeImage",data:JSON.stringify(t),type:"POST",contentType:"application/json; charset=utf-8",beforeSend:onAjaxBeforeSend,dataType:"json",success:function(n){if(!n.d.Success){alert(n.d.Message);return}$("#fmDImgPrev:first").attr("src",$("#fmDImgPrev:first").attr("src")+"&m="+Math.random()).css({height:"auto",width:"auto"})}})}function setCrop(){var n=$("#fmDImgPrev:first"),t=[20,20,n.width()-20,n.height()-20];jCropApi=$.Jcrop($("#fmDImgPrev"),{setSelect:t,onChange:setC}),$("#fmD_CropStart").hide(),$("#fmD_CropCancel").show(),$("#fmD_CropSubmit").show(),$(".fmdPreview-NonCropTools").hide()}function setC(n){$("#x1").val(n.x),$("#y1").val(n.y),$("#x2").val(n.w),$("#y2").val(n.h)}function cancelCrop(){jCropApi!=null&&(jCropApi.destroy(),jCropApi=null),$(".jcrop-holder").remove(),$("#fmD_CropStart").show(),$("#fmD_CropCancel").hide(),$("#fmD_CropSubmit").hide(),$(".fmdPreview-NonCropTools").show()}function submitCrop(){if(jCropApi==null){cancelCrop();return}var n={path:$("#fmDImgPrev:first").attr("data-path"),x:parseInt($("#x1").val()),y:parseInt($("#y1").val()),width:parseInt($("#x2").val()),height:parseInt($("#y2").val())};$.ajax({url:SiteVars.ApplicationRelativeWebRoot+"admin/filemanager/AjaxFileManager.aspx/CropImage",data:JSON.stringify(n),type:"POST",contentType:"application/json; charset=utf-8",beforeSend:onAjaxBeforeSend,dataType:"json",success:function(n){if(!n.d.Success){alert(n.d.Message);return}$("#fmDImgPrev:first").attr("src",$("#fmDImgPrev:first").attr("src")+"&m="+Math.random()).css({height:"auto",width:"auto"})}}),cancelCrop()}function startResize(){startsize.width=$("#fmDImgPrev:first").width(),startsize.height=$("#fmDImgPrev:first").height(),$("#fmdNonResizeTools").hide(),$("#fmdResizeTools").show(),$("#fmdPreview_ImageSlider").slider({max:100,min:1,value:100,slide:function(n,t){$("#fmdPreview_ImageSliderTxt").val(t.value+"%")},change:function(n,t){resizeImage(t.value/100)}}),$("#fmdPreview_ImageSliderTxt").val($("#fmdPreview_ImageSlider").slider("value")+"%")}function resizeImage(n){var t={height:startsize.height*n,width:startsize.height*n};$("#fmDImgPrev:first").css({width:t.width+"px",height:t.height+"px"})}function cancelResizeImage(){$("#fmDImgPrev:first").css({width:startsize.width+"px",height:startsize.height+"px"}),$("#fmdNonResizeTools").show(),$("#fmdResizeTools").hide()}function submitResizeImage(){var t=$("#fmdPreview_ImageSlider").slider("value"),n;$("#fmdResizeTools").hide(),$("#fmdNonResizeTools").show(),n={path:$("#fmDImgPrev:first").attr("data-path"),percent:parseInt(t)},$.ajax({url:SiteVars.ApplicationRelativeWebRoot+"admin/filemanager/AjaxFileManager.aspx/ResizeImage",data:JSON.stringify(n),type:"POST",contentType:"application/json; charset=utf-8",beforeSend:onAjaxBeforeSend,dataType:"json",success:function(n){if(!n.d.Success){alert(n.d.Message);return}$("#fmDImgPrev:first").attr("src",$("#fmDImgPrev:first").attr("src")+"&m="+Math.random()).css({height:"auto",width:"auto"})}})}function onAjaxBeforeSend(n){n.setRequestHeader("x-blog-instance",SiteVars.BlogInstanceId)}var fmdOpen,iExts,jCropApi,startsize;(function(n){n.Jcrop=function(t,i){function c(n){return parseInt(n,10)+"px"}function ut(n){return parseInt(n,10)+"%"}function ot(n){return r.baseClass+"-"+n}function di(){return n.fx.step.hasOwnProperty("backgroundColor")}function kt(t){var i=n(t).offset();return[i.left,i.top]}function ft(n){return[n.pageX-st[0],n.pageY-st[1]]}function ci(t){typeof t!="object"&&(t={}),r=n.extend(r,t),typeof r.onChange!="function"&&(r.onChange=function(){}),typeof r.onSelect!="function"&&(r.onSelect=function(){}),typeof r.onRelease!="function"&&(r.onRelease=function(){})}function bi(n){n!==ii&&(v.setCursor(n),ii=n)}function oi(n,t){st=kt(u),v.setCursor(n==="move"?n:n+"-resize");if(n==="move")return v.activateHandlers(ur(t),bt);var f=o.getFixed(),i=yi(n),r=o.getCorner(yi(i));o.setPressed(o.getCorner(i)),o.setCurrent(r),v.activateHandlers(ki(n,f),bt)}function ki(n,t){return function(i){if(r.aspectRatio)switch(n){case"e":i[1]=t.y+1;break;case"w":i[1]=t.y+1;break;case"n":i[0]=t.x+1;break;case"s":i[0]=t.x+1}else switch(n){case"e":i[1]=t.y2;break;case"w":i[1]=t.y2;break;case"n":i[0]=t.x2;break;case"s":i[0]=t.x2}o.setCurrent(i),f.update()}}function ur(n){var t=n;return wt.watchKeys(),function(n){o.moveOffset([n[0]-t[0],n[1]-t[1]]),t=n,f.update()}}function yi(n){switch(n){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function vi(n){return function(t){return r.disabled?!1:n==="move"&&!r.allowMove?!1:(rt=!0,oi(n,ft(t)),t.stopPropagation(),t.preventDefault(),!1)}}function ai(n,t,i){var u=n.width(),r=n.height();u>t&&t>0&&(u=t,r=t/n.width()*n.height()),r>i&&i>0&&(r=i,u=i/n.height()*n.width()),l=n.width()/u,a=n.height()/r,n.width(u).height(r)}function pt(n){return{x:parseInt(n.x*l,10),y:parseInt(n.y*a,10),x2:parseInt(n.x2*l,10),y2:parseInt(n.y2*a,10),w:parseInt(n.w*l,10),h:parseInt(n.h*a,10)}}function bt(){var t=o.getFixed();t.w>r.minSelect[0]&&t.h>r.minSelect[1]?(f.enableHandles(),f.done()):f.release(),v.setCursor(r.allowSelect?"crosshair":"default")}function hi(n){if(r.disabled)return!1;if(!r.allowSelect)return!1;rt=!0,st=kt(u),f.disableHandles(),bi("crosshair");var t=ft(n);return o.setPressed(t),f.update(),v.activateHandlers(ir,bt),wt.watchKeys(),n.stopPropagation(),n.preventDefault(),!1}function ir(n){o.setCurrent(n),f.update()}function si(){var t=n("<div></div>").addClass(ot("tracker"));return n.browser.msie&&t.css({opacity:0,backgroundColor:"white"}),t}function tr(n){p.removeClass().addClass(ot("holder")).addClass(n)}function rr(n,t){function w(){window.setTimeout(p,tt)}var d=parseInt(n[0],10)/l,nt=parseInt(n[1],10)/a,c=parseInt(n[2],10)/l,v=parseInt(n[3],10)/a,ft,p;if(ni)return;var s=o.flipCoords(d,nt,c,v),h=o.getFixed(),e=[h.x,h.y,h.x2,h.y2],i=e,tt=r.animationDelay,g=s[0]-e[0],it=s[1]-e[1],ut=s[2]-e[2],rt=s[3]-e[3],u=0,k=r.swingSpeed;x=i[0],y=i[1],c=i[2],v=i[3],f.animMode(!0),p=function(){return function(){u+=(100-u)/k,i[0]=x+u/100*g,i[1]=y+u/100*it,i[2]=c+u/100*ut,i[3]=v+u/100*rt,u<99.8||(u=100),u<100?(fi(i),w()):(f.done(),typeof t=="function"&&t.call(b))}}(),w()}function ei(n){fi([parseInt(n[0],10)/l,parseInt(n[1],10)/a,parseInt(n[2],10)/l,parseInt(n[3],10)/a])}function fi(n){o.setPressed([n[0],n[1]]),o.setCurrent([n[2],n[3]]),f.update()}function er(){return pt(o.getFixed())}function fr(){return o.getFixed()}function nr(n){ci(n),gt()}function ri(){r.disabled=!0,f.disableHandles(),f.setCursor("default"),v.setCursor("default")}function ui(){r.disabled=!1,gt()}function wi(){f.done(),v.activateHandlers(null,null)}function pi(){p.remove(),d.show(),n(t).removeData("Jcrop")}function gi(n,t){f.release(),ri();var i=new Image;i.onload=function(){var h=i.width,c=i.height,f=r.boxWidth,o=r.boxHeight;u.width(h).height(c),u.attr("src",n),at.attr("src",n),ai(u,f,o),s=u.width(),e=u.height(),at.width(s).height(e),g.width(s+tt*2).height(e+tt*2),p.width(s).height(e),ui(),typeof t=="function"&&t.call(b)},i.src=n}function gt(n){r.allowResize?n?f.enableOnly():f.enableHandles():f.disableHandles(),v.setCursor(r.allowSelect?"crosshair":"default"),f.setCursor(r.allowMove?"move":"default"),r.hasOwnProperty("setSelect")&&(ei(r.setSelect),f.done(),delete r.setSelect),r.hasOwnProperty("trueSize")&&(l=r.trueSize[0]/s,a=r.trueSize[1]/e),r.hasOwnProperty("bgColor")&&(di()&&r.fadeTime?p.animate({backgroundColor:r.bgColor},{queue:!1,duration:r.fadeTime}):p.css("backgroundColor",r.bgColor),delete r.bgColor),r.hasOwnProperty("bgOpacity")&&(vt=r.bgOpacity,f.isAwake()&&(r.fadeTime?u.fadeTo(r.fadeTime,vt):p.css("opacity",r.opacity)),delete r.bgOpacity),et=r.maxSize[0]||0,ct=r.maxSize[1]||0,lt=r.minSize[0]||0,ht=r.minSize[1]||0,r.hasOwnProperty("outerImage")&&(u.attr("src",r.outerImage),delete r.outerImage),f.refresh()}var r=n.extend({},n.Jcrop.defaults),st,ii,yt=!1,b;n.browser.msie&&n.browser.version.split(".")[0]==="6"&&(yt=!0),typeof t!="object"&&(t=n(t)[0]),typeof i!="object"&&(i={}),ci(i);var li={border:"none",margin:0,padding:0,position:"absolute"},d=n(t),u=d.clone().removeAttr("id").css(li);u.width(d.width()),u.height(d.height()),d.after(u).hide(),ai(u,r.boxWidth,r.boxHeight);var s=u.width(),e=u.height(),p=n("<div />").width(s).height(e).addClass(ot("holder")).css({position:"relative",backgroundColor:r.bgColor}).insertAfter(d).append(u);delete r.bgColor,r.addClass&&p.addClass(r.addClass);var at=n("<img />").attr("src",u.attr("src")).css(li).width(s).height(e),dt=n("<div />").width(ut(100)).height(ut(100)).css({zIndex:310,position:"absolute",overflow:"hidden"}).append(at),nt=n("<div />").width(ut(100)).height(ut(100)).css("zIndex",320),it=n("<div />").css({position:"absolute",zIndex:300}).insertBefore(u).append(dt,nt);yt&&it.css({overflowY:"hidden"});var tt=r.boundary,g=si().width(s+tt*2).height(e+tt*2).css({position:"absolute",top:c(-tt),left:c(-tt),zIndex:290}).mousedown(hi),vt=r.bgOpacity,et,ct,lt,ht,l,a,or=!0,rt,ni,ti;st=kt(u);var k=function(){function n(){var r={},u=["touchstart","touchmove","touchend"],f=document.createElement("div"),t,n,i;try{for(t=0;t<u.length;t++)n=u[t],n="on"+n,i=n in f,i||(f.setAttribute(n,"return;"),i=typeof f[n]=="function"),r[u[t]]=i;return r.touchstart&&r.touchend&&r.touchmove}catch(e){return!1}}function t(){return r.touchSupport===!0||r.touchSupport===!1?r.touchSupport:n()}return{createDragger:function(n){return function(t){return t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,r.disabled?!1:n==="move"&&!r.allowMove?!1:(rt=!0,oi(n,ft(t)),t.stopPropagation(),t.preventDefault(),!1)}},newSelection:function(n){return n.pageX=n.originalEvent.changedTouches[0].pageX,n.pageY=n.originalEvent.changedTouches[0].pageY,hi(n)},isSupported:n,support:t()}}(),o=function(){function nt(r){r=c(r),u=n=r[0],i=t=r[1]}function b(n){n=c(n),y=n[0]-u,p=n[1]-i,u=n[0],i=n[1]}function g(){return[y,p]}function d(r){var o=r[0],f=r[1];0>n+o&&(o-=o+n),0>t+f&&(f-=f+t),e<i+f&&(f+=e-(i+f)),s<u+o&&(o+=s-(u+o)),n+=o,u+=o,t+=f,i+=f}function tt(n){var t=o();switch(n){case"ne":return[t.x2,t.y];case"nw":return[t.x,t.y];case"se":return[t.x2,t.y2];case"sw":return[t.x,t.y2]}}function o(){if(!r.aspectRatio)return k();var y=r.aspectRatio,b=r.minSize[0]/l,p=r.maxSize[0]/l,nt=r.maxSize[1]/a,g=u-n,d=i-t,tt=Math.abs(g),it=Math.abs(d),rt=tt/it,o,c;return p===0&&(p=s*10),nt===0&&(nt=e*10),rt<y?(c=i,w=it*y,o=g<0?n-w:w+n,o<0?(o=0,h=Math.abs((o-n)/y),c=d<0?t-h:h+t):o>s&&(o=s,h=Math.abs((o-n)/y),c=d<0?t-h:h+t)):(o=u,h=tt/y,c=d<0?t-h:t+h,c<0?(c=0,w=Math.abs((c-t)*y),o=g<0?n-w:w+n):c>e&&(c=e,w=Math.abs(c-t)*y,o=g<0?n-w:w+n)),o>n?(o-n<b?o=n+b:o-n>p&&(o=n+p),c=c>t?t+(o-n)/y:t-(o-n)/y):o<n&&(n-o<b?o=n-b:n-o>p&&(o=n-p),c=c>t?t+(n-o)/y:t-(n-o)/y),o<0?(n-=o,o=0):o>s&&(n-=o-s,o=s),c<0?(t-=c,c=0):c>e&&(t-=c-e,c=e),v(f(n,t,o,c))}function c(n){return n[0]<0&&(n[0]=0),n[1]<0&&(n[1]=0),n[0]>s&&(n[0]=s),n[1]>e&&(n[1]=e),[n[0],n[1]]}function f(n,t,i,r){var e=n,o=i,u=t,f=r;return i<n&&(e=i,o=n),r<t&&(u=r,f=t),[Math.round(e),Math.round(u),Math.round(o),Math.round(f)]}function k(){var o=u-n,h=i-t,r;return et&&Math.abs(o)>et&&(u=o>0?n+et:n-et),ct&&Math.abs(h)>ct&&(i=h>0?t+ct:t-ct),ht/a&&Math.abs(h)<ht/a&&(i=h>0?t+ht/a:t-ht/a),lt/l&&Math.abs(o)<lt/l&&(u=o>0?n+lt/l:n-lt/l),n<0&&(u-=n,n-=n),t<0&&(i-=t,t-=t),u<0&&(n-=u,u-=u),i<0&&(t-=i,i-=i),u>s&&(r=u-s,n-=r,u-=r),i>e&&(r=i-e,t-=r,i-=r),n>s&&(r=n-e,i-=r,t-=r),t>e&&(r=t-e,i-=r,t-=r),v(f(n,t,u,i))}function v(n){return{x:n[0],y:n[1],x2:n[2],y2:n[3],w:n[2]-n[0],h:n[3]-n[1]}}var n=0,t=0,u=0,i=0,y,p;return{flipCoords:f,setPressed:nt,setCurrent:b,getOffset:g,moveOffset:d,getCorner:tt,getFixed:o}}(),f=function(){function a(t){var i=n("<div />").css({position:"absolute",opacity:r.borderOpacity}).addClass(ot(t));return dt.append(i),i}function ft(t,i){var r=n("<div />").mousedown(vi(t)).css({cursor:t+"-resize",position:"absolute",zIndex:i});return k.support&&r.bind("touchstart",k.createDragger(t)),nt.append(r),r}function st(n){return ft(n,d++).css({top:c(-i+1),left:c(-i+1),opacity:r.handleOpacity}).addClass(ot("handle"))}function s(n){var f=r.handleSize,u=f,t=f,o=i,e=i;switch(n){case"n":case"s":t=ut(100);break;case"e":case"w":u=ut(100)}return ft(n,d++).width(t).height(u).css({top:c(-o+1),left:c(-e+1)})}function rt(n){for(var i=0;i<n.length;i++)t[n[i]]=st(n[i])}function v(n){var f=Math.round(n.h/2-i),e=Math.round(n.w/2-i),h=-i+1,l=-i+1,u=n.w-i,r=n.h-i,s,o;t.e&&(t.e.css({top:c(f),left:c(u)}),t.w.css({top:c(f)}),t.s.css({top:c(r),left:c(e)}),t.n.css({left:c(e)})),t.ne&&(t.ne.css({left:c(u)}),t.se.css({top:c(r),left:c(u)}),t.sw.css({top:c(r)})),t.b&&(t.b.css({top:c(r)}),t.r.css({left:c(u)}))}function et(n,t){at.css({top:c(-t),left:c(-n)}),it.css({top:c(t),left:c(n)})}function lt(n,t){it.width(n).height(t)}function tt(){var n=o.getFixed();o.setPressed([n.x,n.y]),o.setCurrent([n.x2,n.y2]),y()}function y(){if(e)return p()}function p(){var n=o.getFixed();lt(n.w,n.h),et(n.x,n.y),f&&v(n),e||yt(),r.onChange.call(b,pt(n))}function yt(){it.show(),r.bgFade?u.fadeTo(r.fadeTime,vt):u.css("opacity",vt),e=!0}function bt(){h(),it.hide(),r.bgFade?u.fadeTo(r.fadeTime,1):u.css("opacity",1),e=!1,r.onRelease.call(b)}function wt(){f&&(v(o.getFixed()),nt.show())}function g(){return f=!0,r.allowResize?(v(o.getFixed()),nt.show(),!0):void 0}function h(){f=!1,nt.hide()}function w(n){ni===n?h():g()}function ht(){w(!1),tt()}var e,d=370,ct={},t={},f=!1,i=r.handleOffset,l;return r.drawBorders&&(ct={top:a("hline"),bottom:a("hline bottom"),left:a("vline"),right:a("vline right")}),r.dragEdges&&(t.t=s("n"),t.b=s("s"),t.r=s("e"),t.l=s("w")),r.sideHandles&&rt(["n","s","e","w"]),r.cornerHandles&&rt(["sw","nw","ne","se"]),l=si().mousedown(vi("move")).css({cursor:"move",position:"absolute",zIndex:360}),k.support&&l.bind("touchstart.jcrop",k.createDragger("move")),dt.append(l),h(),{updateVisible:y,update:p,release:bt,refresh:tt,isAwake:function(){return e},setCursor:function(n){l.css("cursor",n)},enableHandles:g,enableOnly:function(){f=!0},showHandles:wt,disableHandles:h,animMode:w,done:ht}}(),v=function(){function y(){g.css({zIndex:450}),s&&n(document).bind("mousemove",i).bind("mouseup",t)}function v(){g.css({zIndex:290}),s&&n(document).unbind("mousemove",i).unbind("mouseup",t)}function i(n){return e(ft(n)),!1}function t(n){return n.preventDefault(),n.stopPropagation(),rt&&(rt=!1,h(ft(n)),f.isAwake()&&r.onSelect.call(b,pt(o.getFixed())),v(),e=function(){},h=function(){}),!1}function p(n,t){return rt=!0,e=n,h=t,y(),!1}function c(n){return n.pageX=n.originalEvent.changedTouches[0].pageX,n.pageY=n.originalEvent.changedTouches[0].pageY,i(n)}function l(n){return n.pageX=n.originalEvent.changedTouches[0].pageX,n.pageY=n.originalEvent.changedTouches[0].pageY,t(n)}function a(n){g.css("cursor",n)}var e=function(){},h=function(){},s=r.trackDocument;return k.support&&n(document).bind("touchmove",c).bind("touchend",l),s||g.mousemove(i).mouseup(t).mouseout(t),u.before(g),{activateHandlers:p,setCursor:a}}(),wt=function(){function c(){r.keySupport&&(t.show(),t.focus())}function s(){t.hide()}function i(n,t,i){r.allowMove&&(o.moveOffset([t,i]),f.updateVisible()),n.preventDefault(),n.stopPropagation()}function e(n){if(n.ctrlKey)return!0;ti=n.shiftKey?!0:!1;var t=ti?10:1;switch(n.keyCode){case 37:i(n,-t,0);break;case 39:i(n,t,0);break;case 38:i(n,0,-t);break;case 40:i(n,0,t);break;case 27:f.release();break;case 9:return!0}return!1}var t=n('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}),h=n("<div />").css({position:"absolute",overflow:"hidden"}).append(t);return r.keySupport&&(t.keydown(e).blur(s),yt||!r.fixedSupport?(t.css({position:"absolute",left:"-20px"}),h.append(t).insertBefore(u)):t.insertBefore(u)),{watchKeys:c}}();return k.support&&g.bind("touchstart",k.newSelection),nt.hide(),gt(!0),b={setImage:gi,animateTo:rr,setSelect:ei,setOptions:nr,tellSelect:er,tellScaled:fr,setClass:tr,disable:ri,enable:ui,cancel:wi,release:f.release,destroy:pi,focus:wt.watchKeys,getBounds:function(){return[s*l,e*a]},getWidgetSize:function(){return[s,e]},getScaleFactor:function(){return[l,a]},ui:{holder:p,selection:it}},n.browser.msie&&p.bind("selectstart",function(){return!1}),d.data("Jcrop",b),b},n.fn.Jcrop=function(t,i){function r(r){var f=typeof t=="object"?t:{},e=f.useImg||r.src,u=new Image;u.onload=function(){function e(){var t=n.Jcrop(r,f);typeof i=="function"&&i.call(t)}function t(){u.width&&u.height?e():window.setTimeout(t,50)}window.setTimeout(t,50)},u.src=e}return this.each(function(){if(n(this).data("Jcrop")){if(t==="api")return n(this).data("Jcrop");n(this).data("Jcrop").setOptions(t)}else r(this)}),this},n.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:9,handleOffset:5,aspectRatio:0,keySupport:!0,cornerHandles:!0,sideHandles:!0,drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onRelease:function(){}}})(jQuery),fmdOpen=!1,iExts=[".png",".jpg",".jpeg",".gif",".bmp"],String.prototype.FileExtension=function(){return this.substring(this.lastIndexOf(".")).toLowerCase()},String.prototype.IsImage=function(){return $.inArray(String(this),iExts)!=-1},$(document).ready(function(){$("#fileManager").click(function(n){n.stopPropagation(),$("#fmD").slideToggle(300,function(){fmdOpen=$("#fmD").is(":visible")}),$(".fmD-left ul li").removeClass("fmDActive"),$(".fmD-right-content").hide(),$(".fmD-left ul li:first").addClass("fmDActive"),$(".fmD-right-content:eq("+$(".fmD-left ul li:first").index()+")").show(),Files("")}),$(".fmD-left ul li").click(function(){$(".fmD-left ul li").removeClass("fmDActive"),$(".fmD-right-content").hide(),$(this).addClass("fmDActive"),$(".fmD-right-content:eq("+$(this).index()+")").show()}),$("#fmD_upload_file").uploadify({uploader:SiteVars.ApplicationRelativeWebRoot+"admin/uploadify/uploadify.swf",script:SiteVars.ApplicationRelativeWebRoot+"admin/filemanager/FileUpload.ashx",scriptData:{b:$("#bId").val()},cancelImg:SiteVars.ApplicationRelativeWebRoot+"admin/uploadify/cancel.png",buttonImg:SiteVars.ApplicationRelativeWebRoot+"admin/filemanager/images/uploadFMD.png",fileDesc:"All Files",auto:!0,onComplete:function(n,t,i,r){var f=r.split(":");if(f[0]!="1")return ShowStatus("warning",f[1]),$(".fmD-upload-right-uploading").hide(),$(".fmD-upload-right-wait").show(),!1;$(".fmD-upload-right-uploading").hide(),$(".fmD-upload-right-wait").show(),ShowStatus("success",'File "'+f[2]+'" uploaded successfully.'),Files(f[3]),$("#fmdUpload_Append").is(":checked")?(setMCE(f[1]),closefmD()):$("#fmdUpload_AppendContinue").is(":checked")?setMCE(f[1]):($(".fmD-left ul li").removeClass("fmDActive"),$(".fmD-right-content").hide(),$(".fmD-left ul li:eq(1)").addClass("fmDActive"),$(".fmD-right-content:eq(1)").show())},onProgress:function(n,t,i,r){return $("#fmD_UploadProgress").progressbar("value",r.percentage),$("#"+$(n.target).attr("id")+t).find(".percentage").text(" - "+bytes+"KB Uploaded"),!1},onOpen:function(n,t,i){$(".fmD-upload-right-wait").hide(),$(".fmD-upload-right-uploading").show(),$("#fmD_UploadFile").text(i.name),$("#fmD_UploadProgress").progressbar("destroy").progressbar({value:0})}});$(document).on("dblclick","tr.fmDRow td",function(){var n=$(this).parent("tr");parseInt(n.attr("data-type"))==0&&Files(n.attr("data-path"))});$(document).on("click","tr.fmDRow td input[type=text]",function(){e.stopPropagation()});$(document).on("click",".fmdPathPiece",function(){Files($(this).attr("data-path"))});Files(" "),$(document).disableSelection()}),jCropApi=null,startsize={width:0,height:0},$.fn.disableSelection=function(){$(this).attr("unselectable","on").css("-moz-user-select","none").each(function(){this.onselectstart=function(){return!1}})}